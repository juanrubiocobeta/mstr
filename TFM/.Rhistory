geom_histogram(aes(y = ..density..),
bins = 100,
fill = "#69b3a2",
color = "white",
alpha = 0.6) +
geom_vline(aes(xintercept = 0), color = "red", linetype = "dashed")
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = ..density..),
bins = 100,
fill = "#69b3a2",
color = "white",
alpha = 0.6) +
geom_vline(aes(xintercept = 0), color = "red", linetype = "dashed")+
coord_cartesian(xlim = c(-0.08, 0.08))
library(tidyquant)
sp500_data <- tq_get("^GSPC",
get  = "stock.prices")
head(sp500_data)
rango_fechas <- range(sp500_data$date)
print(rango_fechas)
library(tidyquant)
sp500_data <- tq_get("^GSPC",
get  = "stock.prices",
from = "1900-01-01")
head(sp500_data)
rango_fechas <- range(sp500_data$date)
print(rango_fechas)
library(dplyr)
sp500_data <- sp500_data %>%
arrange(date) %>%
mutate(daily_return = (close / lag(close)) - 1)
head(sp500_data)
library(ggplot2)
sp500_plot <- na.omit(sp500_data)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = ..density..),
bins = 100,
fill = "#69b3a2",
color = "white",
alpha = 0.6) +
geom_vline(aes(xintercept = 0), color = "red", linetype = "dashed")+
coord_cartesian(xlim = c(-0.08, 0.08))
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = ..density..),
bins = 100,
fill = "#69b3a2",
color = "white",
alpha = 0.6) +
geom_vline(aes(xintercept = 0), color = "red", linetype = "dashed")
coord_cartesian(xlim = c(-0.08, 0.08))
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = ..density..),
bins = 100,
fill = "#69b3a2",
color = "white",
alpha = 0.6) +
geom_vline(aes(xintercept = 0), color = "red", linetype = "dashed")+
coord_cartesian(xlim = c(-0.08, 0.08))
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = ..density..),
bins = 100000,
fill = "#69b3a2",
color = "white",
alpha = 0.6) +
geom_vline(aes(xintercept = 0), color = "red", linetype = "dashed")+
coord_cartesian(xlim = c(-0.08, 0.08))
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = ..density..),
bins = 1000,
fill = "#69b3a2",
color = "white",
alpha = 0.6) +
geom_vline(aes(xintercept = 0), color = "red", linetype = "dashed")+
coord_cartesian(xlim = c(-0.08, 0.08))
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = ..density..),
bins = 100,
fill = "#69b3a2",
color = "white",
alpha = 0.6) +
geom_vline(aes(xintercept = 0), color = "red", linetype = "dashed")+
coord_cartesian(xlim = c(-0.08, 0.08))
sp500_data <- tq_get("^GSPC",
get  = "stock.prices",
from = "1980-01-01")
head(sp500_data)
rango_fechas <- range(sp500_data$date)
print(rango_fechas)
library(dplyr)
sp500_data <- sp500_data %>%
arrange(date) %>%
mutate(daily_return = (close / lag(close)) - 1)
head(sp500_data)
library(ggplot2)
sp500_plot <- na.omit(sp500_data)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = ..density..),
bins = 100,
fill = "#69b3a2",
color = "white",
alpha = 0.6) +
geom_vline(aes(xintercept = 0), color = "red", linetype = "dashed")+
coord_cartesian(xlim = c(-0.08, 0.08))
sd_val <- sd(sp500_plot$daily_return)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
geom_density(color = "darkblue", linewidth = 1) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
if (!require("tseries")) install.packages("tseries")
library(tseries)
resultado_jb <- jarque.bera.test(sp500_plot$daily_return)
print(resultado_jb)
library(moments)
asimetria <- skewness(sp500_plot$daily_return)
curtosis  <- kurtosis(sp500_plot$daily_return)
print(paste("Asimetría (debería ser 0):", round(asimetria, 4)))
print(paste("Curtosis (debería ser 3): ", round(curtosis, 4)))
densidad_k <- density(sp500_plot$daily_return, bw = "SJ")
plot(densidad_k, main = "Distribución Real Estimada (Kernel)", col = "blue", lwd = 2)
sp500_plot <- na.omit(sp500_data)
sd_val <- sd(sp500_plot$daily_return)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
densidad_k <- density(sp500_plot$daily_return, bw = "SJ")
last_plot() +
geom_density(color = "darkblue", linewidth = 1.2)
last_plot() +
geom_density(color = "darkblue", linewidth = 1.2, width=0.5)
last_plot() +
geom_density(color = "darkblue", linewidth = 1.2, width=0.05)
last_plot() +
# Variante 1: Muy detallada (Poca anchura, línea punteada naranja)
geom_density(adjust = 0.2, color = "orange", linetype = "dotted", linewidth = 1) +
# Variante 2: Muy suave (Mucha anchura, línea gruesa morada)
geom_density(adjust = 3, color = "purple", linewidth = 1.2, alpha = 0.5)
sp500_plot <- na.omit(sp500_data)
sd_val <- sd(sp500_plot$daily_return)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
last_plot() +
geom_density(adjust = 0.2, color = "orange", linetype = "dotted", linewidth = 1) +
# Variante 2: Muy suave (Mucha anchura, línea gruesa morada)
geom_density(adjust = 3, color = "purple", linewidth = 1.2, alpha = 0.5)
last_plot() +
geom_density(adjust = 0.2, color = "orange", linetype = "dotted", linewidth = 1) +
geom_density(adjust = 3, color = "purple", linewidth = 1, alpha = 0.5)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
last_plot() +
geom_density(adjust = 0.2, color = "orange", linetype = "dotted", linewidth = 1) +
geom_density(adjust = 3, color = "purple", linewidth = 1, alpha = 0.5)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
last_plot() +
geom_density(color = "orange", linetype = "dotted", linewidth = 1) +
geom_density(color = "purple", linewidth = 1, alpha = 0.5)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
last_plot() +
geom_density(color = "orange", linetype = "dotted", linewidth = 1) +
last_plot() +
geom_density(color = "orange", linetype = "dotted", linewidth = 1)
last_plot() +
geom_density(color = "orange", linetype = "dotted", linewidth = 1)
last_plot() +
geom_density(color = "orange", linetype = "dashed", linewidth = 1)
sd_val <- sd(sp500_plot$daily_return)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
last_plot() +
geom_density(color = "orange", linetype = "dashed", linewidth = 1)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
last_plot() +
geom_density(color = "orange", linewidth = 1)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
last_plot() +
geom_density(color = "orange", linewidth = 0.8)
library(ggplot2)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)),
bins = 100,
fill = "#69b3a2",
alpha = 0.6) +
stat_function(fun = dnorm,
args = list(mean = 0, sd = 1),
color = "red",
linetype = "dashed",
linewidth = 0.8) +
geom_density(color = "orange",
linewidth = 0.8) +
coord_cartesian(xlim = c(-0.12, -0.02),
ylim = c(0, 8)) +
labs(title = "Zoom en la Cola Izquierda (Pérdidas)",
subtitle = "Comparación: Normal (Roja) vs. Realidad (Naranja)",
x = "Retorno Diario",
y = "Densidad") +
theme_minimal()
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)),
bins = 100,
fill = "#69b3a2",
alpha = 0.6) +
stat_function(fun = dnorm,
args = list(mean = 0, sd = 1),
color = "red",
linetype = "dashed",
linewidth = 0.8) +
geom_density(color = "orange",
linewidth = 0.8) +
coord_cartesian(xlim = c(-0.07, -0.02),
ylim = c(0, 8)) +
labs(title = "Zoom en la Cola Izquierda (Pérdidas)",
subtitle = "Comparación: Normal (Roja) vs. Realidad (Naranja)",
x = "Retorno Diario",
y = "Densidad") +
theme_minimal()
# 1. Calculamos estadísticas necesarias para la curva normal teórica
mean_val <- mean(sp500_plot$daily_return, na.rm = TRUE)
sd_val   <- sd(sp500_plot$daily_return, na.rm = TRUE)
# 2. Generamos el gráfico completo
ggplot(sp500_plot, aes(x = daily_return)) +
# Capa 1: Histograma de fondo
geom_histogram(aes(y = after_stat(density)),
bins = 100,
fill = "#69b3a2",
alpha = 0.6) +
# Capa 2: Distribución Normal Teórica (Roja - La teoría)
stat_function(fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "red",
linetype = "dashed",
linewidth = 0.8) +
# Capa 3: Densidad Kernel (Naranja - La realidad)
geom_density(color = "orange",
linewidth = 0.8) +
# Capa 4: ZOOM en la COLA IZQUIERDA
# xlim: miramos desde -12% hasta -2%
# ylim: cortamos la altura a 8 para que se vean bien las líneas (si no, se ven planas)
coord_cartesian(xlim = c(-0.12, -0.02),
ylim = c(0, 8)) +
# Etiquetas y tema
labs(title = "Zoom en la Cola Izquierda (Pérdidas)",
subtitle = "Comparación: Normal (Roja) vs. Realidad (Naranja)",
x = "Retorno Diario",
y = "Densidad") +
theme_minimal()
# 2. Generamos el gráfico completo
ggplot(sp500_plot, aes(x = daily_return)) +
# Capa 1: Histograma de fondo
geom_histogram(aes(y = after_stat(density)),
bins = 100,
fill = "#69b3a2",
alpha = 0.6) +
# Capa 2: Distribución Normal Teórica (Roja - La teoría)
stat_function(fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "red",
linetype = "dashed",
linewidth = 0.8) +
# Capa 3: Densidad Kernel (Naranja - La realidad)
geom_density(color = "orange",
linewidth = 0.8) +
# Capa 4: ZOOM en la COLA IZQUIERDA
# xlim: miramos desde -12% hasta -2%
# ylim: cortamos la altura a 8 para que se vean bien las líneas (si no, se ven planas)
coord_cartesian(xlim = c(-0.07, -0.02),
ylim = c(0, 8)) +
# Etiquetas y tema
labs(title = "Zoom en la Cola Izquierda (Pérdidas)",
subtitle = "Comparación: Normal (Roja) vs. Realidad (Naranja)",
x = "Retorno Diario",
y = "Densidad") +
theme_minimal()
# 2. Generamos el gráfico completo
ggplot(sp500_plot, aes(x = daily_return)) +
# Capa 1: Histograma de fondo
geom_histogram(aes(y = after_stat(density)),
bins = 100,
fill = "#69b3a2",
alpha = 0.6) +
# Capa 2: Distribución Normal Teórica (Roja - La teoría)
stat_function(fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "red",
linetype = "dashed",
linewidth = 0.8) +
# Capa 3: Densidad Kernel (Naranja - La realidad)
geom_density(color = "orange",
linewidth = 0.8) +
# Capa 4: ZOOM en la COLA IZQUIERDA
# xlim: miramos desde -12% hasta -2%
# ylim: cortamos la altura a 8 para que se vean bien las líneas (si no, se ven planas)
coord_cartesian(xlim = c(-0.07, -0.015),
ylim = c(0, 8)) +
# Etiquetas y tema
labs(title = "Zoom en la Cola Izquierda (Pérdidas)",
subtitle = "Comparación: Normal (Roja) vs. Realidad (Naranja)",
x = "Retorno Diario",
y = "Densidad") +
theme_minimal()
# 2. Generamos el gráfico completo
ggplot(sp500_plot, aes(x = daily_return)) +
# Capa 1: Histograma de fondo
geom_histogram(aes(y = after_stat(density)),
bins = 100,
fill = "#69b3a2",
alpha = 0.6) +
# Capa 2: Distribución Normal Teórica (Roja - La teoría)
stat_function(fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "red",
linetype = "dashed",
linewidth = 0.8) +
# Capa 3: Densidad Kernel (Naranja - La realidad)
geom_density(color = "orange",
linewidth = 0.8) +
# Capa 4: ZOOM en la COLA IZQUIERDA
# xlim: miramos desde -12% hasta -2%
# ylim: cortamos la altura a 8 para que se vean bien las líneas (si no, se ven planas)
coord_cartesian(xlim = c(-0.07, -0.015),
ylim = c(0, 6)) +
# Etiquetas y tema
labs(title = "Zoom en la Cola Izquierda (Pérdidas)",
subtitle = "Comparación: Normal (Roja) vs. Realidad (Naranja)",
x = "Retorno Diario",
y = "Densidad") +
theme_minimal()
# 2. Generamos el gráfico completo
ggplot(sp500_plot, aes(x = daily_return)) +
# Capa 1: Histograma de fondo
geom_histogram(aes(y = after_stat(density)),
bins = 1000,
fill = "#69b3a2",
alpha = 0.6) +
# Capa 2: Distribución Normal Teórica (Roja - La teoría)
stat_function(fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "red",
linetype = "dashed",
linewidth = 0.8) +
# Capa 3: Densidad Kernel (Naranja - La realidad)
geom_density(color = "orange",
linewidth = 0.8) +
# Capa 4: ZOOM en la COLA IZQUIERDA
# xlim: miramos desde -12% hasta -2%
# ylim: cortamos la altura a 8 para que se vean bien las líneas (si no, se ven planas)
coord_cartesian(xlim = c(-0.07, -0.015),
ylim = c(0, 6)) +
# Etiquetas y tema
labs(title = "Zoom en la Cola Izquierda (Pérdidas)",
subtitle = "Comparación: Normal (Roja) vs. Realidad (Naranja)",
x = "Retorno Diario",
y = "Densidad") +
theme_minimal()
# 2. Generamos el gráfico completo
ggplot(sp500_plot, aes(x = daily_return)) +
# Capa 1: Histograma de fondo
geom_histogram(aes(y = after_stat(density)),
bins = 1000,
fill = "#69b3a2",
alpha = 0.6) +
# Capa 2: Distribución Normal Teórica (Roja - La teoría)
stat_function(fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "red",
linetype = "dashed",
linewidth = 0.8) +
# Capa 3: Densidad Kernel (Naranja - La realidad)
geom_density(color = "orange",
linewidth = 0.8) +
# Capa 4: ZOOM en la COLA IZQUIERDA
# xlim: miramos desde -12% hasta -2%
# ylim: cortamos la altura a 8 para que se vean bien las líneas (si no, se ven planas)
coord_cartesian(xlim = c(-0.07, -0.015),
ylim = c(0, 8)) +
# Etiquetas y tema
labs(title = "Zoom en la Cola Izquierda (Pérdidas)",
subtitle = "Comparación: Normal (Roja) vs. Realidad (Naranja)",
x = "Retorno Diario",
y = "Densidad") +
theme_minimal()
library(readxl)
# 1. Cargar datos
datos <- read_excel("datos_culturales.xlsx")
datos_num <- datos[, -1] # Eliminar columna de nombres
setwd("~/mstr/multivariante/cuestionario 7")
library(readxl)
# 1. Cargar datos
datos <- read_excel("datos_culturales.xlsx")
datos_num <- datos[, -1] # Eliminar columna de nombres
View(datos)
View(datos)
View(datos_num)
datos_num <- datos[, -1] # Eliminar columna de nombres
# 2. Ejecutar K-means para k=3 y k=4 (usamos nstart alto para estabilidad)
set.seed(123) # Semilla para reproducibilidad
km3 <- kmeans(datos_num, centers = 3, nstart = 25)
km4 <- kmeans(datos_num, centers = 4, nstart = 25)
# 3. Calcular el porcentaje de varianza explicada (Betweenss / Totss)
prop3 <- (km3$betweenss / km3$totss) * 100
prop4 <- (km4$betweenss / km4$totss) * 100
# 4. Imprimir resultados
cat("Para 3 centros (k=3):", round(prop3, 1), "%\n")
cat("Para 4 centros (k=4):", round(prop4, 1), "%\n")
View(km3)
View(km3)
View(km3)
View(km4)
setwd("~/mstr/multivariante/cuestionario5")
datos <- read.table("Genero.txt", header = TRUE)
datos_mca <- subset(datos, select = -Continent)
View(datos)
setwd("~/mstr/TFM")
library(tidyquant)
sp500_data <- tq_get("^GSPC",
get  = "stock.prices",
from = "1980-01-01")
head(sp500_data)
library(tidyquant)
sp500_data <- tq_get("^GSPC",
get  = "stock.prices",
from = "1980-01-01")
head(sp500_data)
sp500_data <- tq_get("^GSPC",
get  = "stock.prices",
from = "1980-01-01")
View(sp500_data)
View(sp500_data)
head(sp500_data)
source("~/mstr/TFM/kernelsp.R", echo = TRUE)
head(sp500_data)
rango_fechas <- range(sp500_data$date)
print(rango_fechas)
library(dplyr)
sp500_data <- sp500_data %>%
arrange(date) %>%
mutate(daily_return = (close / lag(close)) - 1)
head(sp500_data)
library(ggplot2)
sp500_plot <- na.omit(sp500_data)
sd_val <- sd(sp500_plot$daily_return)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)), bins = 100, fill = "#69b3a2", alpha = 0.6) +
stat_function(fun = dnorm, args = list(mean = 0, sd = sd_val), color = "red", linetype = "dashed") +
coord_cartesian(xlim = c(-0.08, 0.08)) +
theme_minimal()
library(tseries)
resultado_jb <- jarque.bera.test(sp500_plot$daily_return)
print(resultado_jb)
km3[["cluster"]]
library(moments)
asimetria <- skewness(sp500_plot$daily_return)
curtosis  <- kurtosis(sp500_plot$daily_return)
print(paste("Asimetría (debería ser 0):", round(asimetria, 4)))
print(paste("Curtosis (debería ser 3): ", round(curtosis, 4)))
last_plot() +
geom_density(color = "orange", linewidth = 0.8)
library(ggplot2)
mean_val <- mean(sp500_plot$daily_return, na.rm = TRUE)
sd_val   <- sd(sp500_plot$daily_return, na.rm = TRUE)
ggplot(sp500_plot, aes(x = daily_return)) +
geom_histogram(aes(y = after_stat(density)),
bins = 1000,
fill = "#69b3a2",
alpha = 0.6) +
stat_function(fun = dnorm,
args = list(mean = mean_val, sd = sd_val),
color = "red",
linetype = "dashed",
linewidth = 0.8) +
geom_density(color = "orange",
linewidth = 0.8) +
coord_cartesian(xlim = c(-0.07, -0.015),
ylim = c(0, 8))
library(tidyquant)
sp500_data <- tq_get("^GSPC",
get  = "stock.prices",
from = "1980-01-01")
head(sp500_data)
